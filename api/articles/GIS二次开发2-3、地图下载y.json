{"title":"2-3、地图下载","uid":"e81741e7ff158484653e9cc5cbdf14ba","slug":"GIS二次开发2-3、地图下载y","date":"2022-12-07T15:50:04.290Z","updated":"2022-12-07T15:50:35.215Z","comments":true,"path":"api/articles/GIS二次开发2-3、地图下载y.json","keywords":null,"cover":null,"content":"<p><a name=\"iwakI\"></a></p>\n<h4 id=\"1、-导入FileSaver-js\"><a href=\"#1、-导入FileSaver-js\" class=\"headerlink\" title=\"1、 导入FileSaver.js\"></a>1、 导入FileSaver.js</h4><pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;lib.baomitu.com&#x2F;FileSaver.js&#x2F;2.0.5&#x2F;FileSaver.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre>\n<p><a name=\"Hepv1\"></a></p>\n<h4 id=\"2、设置数据源跨域\"><a href=\"#2、设置数据源跨域\" class=\"headerlink\" title=\"2、设置数据源跨域\"></a>2、设置数据源跨域</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>crossOrigin: “Anonymous”</p></blockquote>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">const key &#x3D; &#39;8a5c2b00e94b49659861e064c37f778d&#39;\n&#x2F;* 天地图矢量图层 *&#x2F;\nconst TianDiMap_vec &#x3D; new ol.layer.Tile(&#123;\n  title: &quot;天地图矢量图层&quot;,\n  source: new ol.source.XYZ(&#123;\n    url: &#39;http:&#x2F;&#x2F;t0.tianditu.com&#x2F;DataServer?T&#x3D;vec_w&amp;x&#x3D;&#123;x&#125;&amp;y&#x3D;&#123;y&#125;&amp;l&#x3D;&#123;z&#125;&amp;tk&#x3D;&#39; +\n    key,\n    wrapX: false,\n    crossOrigin: &quot;Anonymous&quot;\n  &#125;)\n&#125;)\n&#x2F;* 天地图注记图层 *&#x2F;\nconst TianDiMap_cva &#x3D; new ol.layer.Tile(&#123;\n  title: &quot;天地图矢量注记图层&quot;,\n  source: new ol.source.XYZ(&#123;\n    url: &#39;http:&#x2F;&#x2F;t0.tianditu.com&#x2F;DataServer?T&#x3D;cva_w&amp;x&#x3D;&#123;x&#125;&amp;y&#x3D;&#123;y&#125;&amp;l&#x3D;&#123;z&#125;&amp;tk&#x3D;&#39; +\n    key,\n    wrapX: false,\n    crossOrigin: &quot;Anonymous&quot;\n  &#125;)\n&#125;)</code></pre>\n<p><a name=\"mBHqv\"></a></p>\n<h4 id=\"3、下载\"><a href=\"#3、下载\" class=\"headerlink\" title=\"3、下载\"></a>3、下载</h4><pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&lt;body&gt;\n    &lt;button onclick&#x3D;&quot;exportImg()&quot;&gt;导出图片&lt;&#x2F;button&gt;\n    &lt;div id&#x3D;&quot;map_container&quot;&gt;\n\n    &lt;&#x2F;div&gt;\n    &lt;script&gt;\n        var map &#x3D; new ol.Map(&#123;\n            target: &quot;map_container&quot;,\n            layers: [TianDiMap_vec, TianDiMap_cva],\n            view: new ol.View(&#123;\n                center: [114, 30],\n                projection: &#39;EPSG:4326&#39;,\n                zoom: 4\n            &#125;)\n        &#125;)\n\n        function exportImg() &#123;\n            map.once(&#39;postcompose&#39;, function (event) &#123;\n                const canvas &#x3D; event.context.canvas\n                console.log(canvas)\n                canvas.toBlob(function (blob) &#123;\n                    console.log(blob)\n                    saveAs(blob, &#39;map.png&#39;)\n                &#125;)\n            &#125;)\n            map.renderSync()\n        &#125;\n    &lt;&#x2F;script&gt;\n&lt;&#x2F;body&gt;</code></pre>\n<p><a name=\"VHhGA\"></a></p>\n<h4 id=\"4、如果是图层中有地图文档，也需设置跨域\"><a href=\"#4、如果是图层中有地图文档，也需设置跨域\" class=\"headerlink\" title=\"4、如果是图层中有地图文档，也需设置跨域\"></a>4、如果是图层中有地图文档，也需设置跨域</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">var docLayer &#x3D; new Zondy.Map.Doc(&quot;&quot;,docName , &#123;\n    ip: &quot;localhost&quot;,\n    port: 6163,\n    crossOrigin: &quot;Anonymous&quot;\n&#125;);</code></pre>\n","text":" 1、 导入FileSaver.js&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;lib.baomitu.com&#x2F;FileSaver.js&#x2F;2.0.5&#x2F;FileSaver.js&quot;&gt;&lt;&#...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"GIS二次开发","slug":"GIS二次开发","count":29,"path":"api/categories/GIS二次开发.json"}],"tags":[{"name":"D2 地图操作","slug":"D2-地图操作","count":4,"path":"api/tags/D2-地图操作.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1%E3%80%81-%E5%AF%BC%E5%85%A5FileSaver-js\"><span class=\"toc-text\">1、 导入FileSaver.js</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2%E3%80%81%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90%E8%B7%A8%E5%9F%9F\"><span class=\"toc-text\">2、设置数据源跨域</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3%E3%80%81%E4%B8%8B%E8%BD%BD\"><span class=\"toc-text\">3、下载</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4%E3%80%81%E5%A6%82%E6%9E%9C%E6%98%AF%E5%9B%BE%E5%B1%82%E4%B8%AD%E6%9C%89%E5%9C%B0%E5%9B%BE%E6%96%87%E6%A1%A3%EF%BC%8C%E4%B9%9F%E9%9C%80%E8%AE%BE%E7%BD%AE%E8%B7%A8%E5%9F%9F\"><span class=\"toc-text\">4、如果是图层中有地图文档，也需设置跨域</span></a></li></ol>","author":{"name":"团子","slug":"blog-author","avatar":"https://blog4xk-1309331490.cos.ap-nanjing.myqcloud.com/markdown/QQ%E5%9B%BE%E7%89%8720221205215218.jpg","link":"/","description":"处变不惊   安之若素","socials":{"github":"https://github.com/codbish","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/bguihiub","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"2-1、视图操作","uid":"3e89a870f873356e143f8a9e2a5a51c1","slug":"GIS二次开发2-1、视图操作","date":"2022-12-07T15:55:08.709Z","updated":"2022-12-07T16:08:43.618Z","comments":true,"path":"api/articles/GIS二次开发2-1、视图操作.json","keywords":null,"cover":null,"text":" const view = map.getView() 获取视图 view.getZoom() view.setZoom() view.getCenter(); view.setCenter(); 通过接口map.getView获取视图对象，可以进一步对视图进行操作 放大/缩小：...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"GIS二次开发","slug":"GIS二次开发","count":29,"path":"api/categories/GIS二次开发.json"}],"tags":[{"name":"D2 地图操作","slug":"D2-地图操作","count":4,"path":"api/tags/D2-地图操作.json"}],"author":{"name":"团子","slug":"blog-author","avatar":"https://blog4xk-1309331490.cos.ap-nanjing.myqcloud.com/markdown/QQ%E5%9B%BE%E7%89%8720221205215218.jpg","link":"/","description":"处变不惊   安之若素","socials":{"github":"https://github.com/codbish","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/bguihiub","juejin":"","customs":{}}}},"next_post":{"title":"2-4、飞行视角","uid":"d7088e96041666084b9c7806e13f13ea","slug":"GIS二次开发2-4、飞行视角","date":"2022-12-07T15:32:52.385Z","updated":"2022-12-07T15:56:07.626Z","comments":true,"path":"api/articles/GIS二次开发2-4、飞行视角.json","keywords":null,"cover":null,"text":"map.getView().animate(&#123; center:[114,30], zoom:10, duration:1000 &#125;)","link":"","photos":[],"count_time":{"symbolsCount":94,"symbolsTime":"1 mins."},"categories":[{"name":"GIS二次开发","slug":"GIS二次开发","count":29,"path":"api/categories/GIS二次开发.json"}],"tags":[{"name":"D2 地图操作","slug":"D2-地图操作","count":4,"path":"api/tags/D2-地图操作.json"}],"author":{"name":"团子","slug":"blog-author","avatar":"https://blog4xk-1309331490.cos.ap-nanjing.myqcloud.com/markdown/QQ%E5%9B%BE%E7%89%8720221205215218.jpg","link":"/","description":"处变不惊   安之若素","socials":{"github":"https://github.com/codbish","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/bguihiub","juejin":"","customs":{}}}}}